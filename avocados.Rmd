---
title: "Hass Avocado Analysis"
author: "Jeremy Meguira"
date: "October 9, 2018"
output: 
  html_document: 
    fig_height: 10
    fig_width: 10
    toc: yes
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Hass Avocado Analysis
This dataset was pulled from:
https://www.kaggle.com/neuromusic/avocado-prices/home

It contains historical data on avocado prices and sales volume in multiple US
markets.

Some questions I want to look at in this analysis:

* How do the prices of avocados vary by region?
* What happened to avocado prices and consumption in 2017?
* How does consumption/pricing change based on organic/conventional avocados?

If any other interesting questions come up I will look into them as well.


```{r echo = FALSE}

library(ggplot2)
library(knitr)
library(GGally)
library(gridExtra)

```

## Load and Examine Dataset

```{r echo = FALSE, Loading_Data}

av <- read.csv('avocado.csv')

```

Variable descriptions are provided by the dataset poster:

* Date - The date of the observation
* AveragePrice - the average price of a single avocado
* type - conventional or organic
* year - the year
* Region - the city or region of the observation
* Total Volume - Total number of avocados sold
* 4046 - Total number of avocados with PLU 4046 sold / small hass avocados
* 4225 - Total number of avocados with PLU 4225 sold / large hass avocados
* 4770 - Total number of avocados with PLU 4770 sold / x-large hass avocados

## Clean

Check for duplicate rows

```{r echo = FALSE}

sum(duplicated(av))

```

Check for missing values

```{r echo = FALSE}

sum(is.na(av))

```

Looks like a pretty clean data set. No missing values or duplicated rows. Now 
let's look into the individual variables a bit

```{r echo = FALSE}

str(av)
 
```

The  year variable is redundant, as that information is already contained in the
date variable, so we can drop it.

```{r echo = FALSE}

#https://stackoverflow.com/a/4605268

drops <- c('year')
av <- av[ , !names(av) %in% drops]
str(av)


```

As we can see, date is currently of Factor type which is usually reserved for
categorical data. I will change it to a date object

```{r echo = FALSE}

av$Date <- as.POSIXct(av$Date)
str(av$Date)

```

Since we know the price of the average avocado at the date of the observation
and the total # of avocados sold, we can create a new variable gross_sales to
show the income for that week at each location purely from avocado sales.

Summary statistics for gross sales:

```{r echo = FALSE}

av$gross_sales <- av$Total.Volume * av$AveragePrice 
summary(av$gross_sales)

```

```{r echo = FALSE}

unique(av$region)

```


```{r echo = FALSE}

av_total_org <- subset(av, av$region == "TotalUS" & av$type == "organic")
av_total_con <- subset(av, av$region == "TotalUS" & av$type == "conventional")

region_list <- list('Midsouth', 'Northeast', 'NorthernNewEngland','West', 'SouthCentral', 'Southeast','Plains', 'West')
av_regional_org <- subset(av, av$region %in% region_list & av$type == "organic")
av_regional_con <- subset(av, av$region %in% region_list & av$type == "conventional")

region_list <- list('Midsouth', 'Northeast', 'NorthernNewEngland','West', 'SouthCentral', 'Southeast','Plains', 'West', 'TotalUS')
av_city_org <- subset(av, !(av$region %in% region_list) & av$type == "organic")
av_city_con <- subset(av, !(av$region %in% region_list) & av$type == "conventional")

```



## Explore


Variable distribution:

```{r echo = FALSE}

summary(av)

```

We can see that there are going to be some clear outliers in variables where the
mean and max values are much higher than the 3rd quartile.

```{r echo = FALSE}

ap1 <- ggplot(aes(y = av$AveragePrice), data = av) +
  geom_boxplot(fill = 'orange') + 
  ylab('Average Avocado Price')

ap2 <- ggplot(aes(x = av$AveragePrice), data = av) +
  geom_histogram(fill = 'orange')

grid.arrange(ap1, ap2, ncol = 1)

```

Average price is fairly normally distributed and the bulk of the prices fall
between $1 and $1.50. I'm realizing now that I should group the entire dataset
by avocado type (organic vs conventional) as I suspect. We can drop the type
variable from these new data subsets.

```{r echo = FALSE}

print('Total organic avocado sales:')
sum(av_org$Total.Volume)
print('Total conventional avocado sales')
sum(av_con$Total.Volume)
print('Organic percentage of total avocado sales:')
(sum(av_org$Total.Volume)/sum(av$Total.Volume))*100

print('Gross sales for organic avocados')
sum(av_org$gross_sales)
print('Gross sales for conventional avocados')
sum(av_con$gross_sales)
print('Organic percentage of gross avocado sales:')
(sum(av_org$gross_sales)/sum(av$gross_sales))*100

print('Average price of organic avocado:')
mean(av_org$AveragePrice)
print('Average price of conventional avocado:')
mean(av_con$AveragePrice)

```

Great, so now we have the data subsets for organic and conventional avocados. We
also learned that only about 3% of avocados sold are organic and they make up
~4% of the gross avocado sales. Further, we can see that organic avocados are on
average 50 cents more expensive per avocado. Now let's go back to the
distributions and see how avocado type affects the charts.

```{r echo = FALSE}

ap1_org <- ggplot(aes(y = av_total_org$AveragePrice), data = av_total_org) +
  geom_boxplot(fill = 'orange') + 
  ylab('Average Organic Avocado Price')

ap2_org <- ggplot(aes(x = av_total_org$AveragePrice), data = av_total_org) +
  geom_histogram(fill = 'orange')

ap1_con <- ggplot(aes(y = av_total_con$AveragePrice), data = av_total_con) +
  geom_boxplot(fill = 'orange') + 
  ylab('Average Conventional Avocado Price')

ap2_con <- ggplot(aes(x = av_total_con$AveragePrice), data = av_total_con) +
  geom_histogram(fill = 'orange')

grid.arrange(ap1_org, ap2_org, ap1_con, ap2_con, ncol = 2) 

```

```{r echo = FALSE}

p1 <- ggplot(aes(x = av$X4046), data = av) +
  geom_histogram(fill = 'orange') +
  ggtitle('x4046 histogram') +
  coord_cartesian(xlim = c(0, quantile(av$X4046,.90)))

p2 <- ggplot(aes(x = av$X4225), data = av) +
  geom_histogram(fill = 'orange') +
  ggtitle('x4225 histogram') +
  coord_cartesian(xlim = c(0, quantile(av$X4225,.90)))

p3 <- ggplot(aes(x = av$X4770), data = av) +
  geom_histogram(fill = 'orange') +
  ggtitle('x4770 histogram') +
  coord_cartesian(xlim = c(0, quantile(av$X4770,.98)))

grid.arrange(p1,p2,p3, ncol = 1)
 
```


```{r echo = FALSE}

ggplot(aes(x = Date, y = Total.Volume), data = av_total_con) + 
  geom_point(stat = 'identity')

ggplot(aes(x = Date, y = Total.Volume), data = av_total_org) +
  geom_point(stat = 'identity')

ggplot(aes(x = Date, y = gross_sales, color = type), data = subset(av_city, av_city$type == 'conventional')) + 
  geom_jitter(stat = 'summary', fun.y = mean) +
  scale_x_datetime(limits = c(as.POSIXct("2017-01-01"), as.POSIXct("2018-01-01")))



```


